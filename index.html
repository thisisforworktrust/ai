<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Beef AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body { background: #09090b; color: #e4e4e7; font-family: 'Inter', sans-serif; overflow: hidden; }
#chat-box { scroll-behavior: smooth; }
#chat-box::-webkit-scrollbar { width: 6px; }
#chat-box::-webkit-scrollbar-track { background: transparent; }
#chat-box::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
.msg { padding: 12px 16px; border-radius: 12px; font-size: 0.95rem; max-width: 85%; word-wrap: break-word; line-height: 1.6; animation: fadeIn 0.3s ease; }
.ai-msg { background: #18181b; border: 1px solid #27272a; color: #d4d4d4; margin-right: auto; border-bottom-left-radius: 2px; }
.ai-msg pre { background: #111; padding: 10px; border-radius: 6px; overflow-x: auto; margin-top: 10px; }
.ai-msg code { font-family: monospace; background: #222; padding: 2px 4px; border-radius: 4px; }
.ai-msg p { margin-bottom: 8px; }
.ai-msg p:last-child { margin-bottom: 0; }
.user-msg { background: #2563eb; color: white; margin-left: auto; text-align: right; border-bottom-right-radius: 2px; }
.error-msg { background: #451a1a; color: #fca5a5; margin: auto; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>

<body class="flex flex-col h-screen">

<div class="border-b border-zinc-800 bg-zinc-950 p-4 flex justify-between items-center shadow-lg">
  <div class="flex items-center gap-2">
    <h1 class="font-bold text-white text-xl tracking-tight">BEEF.<span class="text-blue-500">AI</span></h1>
  </div>
  <div id="status" class="text-xs font-mono text-green-500">● ONLINE</div>
</div>

<div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4">
  <div class="ai-msg msg">
    Hello! I am Beef. How can I help you today?
  </div>
</div>

<div class="p-4 bg-zinc-950 border-t border-zinc-800">
  <form id="inputForm" class="flex gap-2 max-w-4xl mx-auto">
    <input id="prompt" type="text" placeholder="Type a message..." autocomplete="off" required
      class="flex-1 bg-zinc-900 border border-zinc-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-blue-500 transition-colors">
    
    <button type="submit" id="send-btn"
      class="bg-blue-600 hover:bg-blue-500 text-white px-6 rounded-lg font-bold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
      Send
    </button>
  </form>
</div>

<script>
const chatBox = document.getElementById('chat-box');
const inputForm = document.getElementById('inputForm');
const promptInput = document.getElementById('prompt');
const sendBtn = document.getElementById('send-btn');
const statusDiv = document.getElementById('status');

// === PeerJS Client Setup ===
const peer = new Peer(); // auto-generated client ID
const hostId = "beef-ai-server"; // preset host
let conn = null;

// Connect to host
function connectToHost() {
  conn = peer.connect(hostId);

  conn.on('open', () => {
    console.log('Connected to host:', hostId);
    statusDiv.textContent = "● ONLINE";
    statusDiv.className = "text-xs font-mono text-green-500";
  });

  conn.on('data', (data) => {
    // Add AI message from host
    addMessage(data, 'ai');
    promptInput.disabled = false;
    sendBtn.disabled = false;
    promptInput.focus();
    statusDiv.textContent = "● ONLINE";
    statusDiv.className = "text-xs font-mono text-green-500";
  });

  conn.on('close', () => {
    console.log('Connection closed, retrying...');
    statusDiv.textContent = "● OFFLINE";
    statusDiv.className = "text-xs font-mono text-red-500";
    setTimeout(connectToHost, 2000); // auto-reconnect
  });

  conn.on('error', (err) => {
    console.error('PeerJS error:', err);
  });
}

peer.on('open', (id) => {
  console.log('Client ID:', id);
  connectToHost();
});

// Helper to add messages
function addMessage(text, type) {
  const div = document.createElement('div');
  if (type === 'user') {
    div.className = 'msg user-msg';
    div.textContent = text;
  } else if (type === 'ai') {
    div.className = 'msg ai-msg';
    div.innerHTML = marked.parse(text);
  } else if (type === 'error') {
    div.className = 'msg error-msg';
    div.textContent = text;
  }
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Form submit: send message to host
inputForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const userText = promptInput.value.trim();
  if (!userText || !conn || conn.open === false) return;

  // Show user message
  addMessage(userText, 'user');
  promptInput.value = '';
  promptInput.disabled = true;
  sendBtn.disabled = true;
  statusDiv.textContent = "○ THINKING...";
  statusDiv.className = "text-xs font-mono text-yellow-500";

  // Placeholder bubble
  const loadingBubble = document.createElement('div');
  loadingBubble.className = 'msg ai-msg animate-pulse';
  loadingBubble.textContent = "...";
  chatBox.appendChild(loadingBubble);
  chatBox.scrollTop = chatBox.scrollHeight;

  // Send message to host
  conn.send(userText);
});
</script>

</body>
</html>
